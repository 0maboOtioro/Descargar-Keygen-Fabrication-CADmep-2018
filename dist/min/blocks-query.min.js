function parseCallback(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}function keys(a){var b={};return blocks.each(a,function(a){b[a]=!0}),b}function returnFalse(){return!1}function returnTrue(){return!0}function Event(a){this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?returnTrue:returnFalse,this.timeStamp=a.timeStamp||+new Date}function addListener(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,Event.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,Event.fix(a))})}function getClassIndex(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}function escapeValue(a){return String(a).replace(ampRegEx,"&amp;").replace(quotRegEx,"&quot;").replace(singleQuoteRegEx,"&#39;").replace(lessThanRegEx,"&lt;").replace(greaterThanRegEx,"&gt;")}function resolveKeyValue(a,b,c){"string"==typeof a?c(a,b):blocks.isPlainObject(a)&&blocks.each(a,function(a,b){c(b,a)})}function createFragment(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),-1!=a.indexOf("<option")&&-1==a.indexOf("<select")?(a="<select>"+a+"</select>",d=2):-1==a.indexOf("<table")&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):-1!=a.indexOf("<tr")?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}function parseVersion(a){return a?parseFloat(a[1]):void 0}function on(a,b,c){Workarounds[b]?Workarounds[b](a,c,function(b,c){addListener(a,b,c)}):addListener(a,b,c)}function HtmlElement(a){return HtmlElement.prototype.isPrototypeOf(this)?void(this._element=a):new HtmlElement(a)}function VirtualElement(a){return VirtualElement.prototype.isPrototypeOf(this)?(this._tagName=a?a.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=VirtualElement.RenderMode.All,this._haveStyle=!1,this._style={},this._changes=null,void(this._el=blocks.isElement(a)?HtmlElement(a):HtmlElement.Empty())):new VirtualElement(a)}function generateStyleAttribute(a){var b,c,d=' style="',e=!1;for(b in a)c=a[b],(c||0===c)&&(e=!0,b=b.replace(/[A-Z]/g,replaceStyleAttribute),d+=b,d+=":",d+=c,d+=";");return d+='"',e?d:""}function replaceStyleAttribute(a){return"-"+a.toLowerCase()}function setClass(a,b,c){if(null!=c){c=blocks.isArray(c)?c:c.toString().split(" ");var d,e,f,g=0;if(VirtualElement.Is(b))d=b._attributes[classAttr];else{if(b.classList)return void(classListMultiArguments?b.classList[a].apply(b.classList,c):blocks.each(c,function(c){b.classList[a](c)}));d=b.className}for(d=d||"";g<c.length;g++)e=c[g],f=getClassIndex(d,e),"add"==a?0>f&&(""!==d&&(e=" "+e),d+=e):-1!=f&&(d=(d.substring(0,f)+" "+d.substring(f+e.length+1,d.length)).replace(trimRegExp,""));VirtualElement.Is(b)?b._attributes[classAttr]=d:b.className=d}}function getIndexOffset(a,b){var c=ElementsData.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,g=0;b!=g;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,-1==getClassIndex(d,"b-hide")&&g++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;-1!=getClassIndex(d,"b-hide");){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function animateDomAction(a,b){var c=!1,d=ElementsData.createIfNotExists(b),e=ElementsData.createIfNotExists(b.parentNode),f=d.animateCallback,g="remove"==a?"hide":"add"==a?"show":a,h="remove"==a?function(){ElementsData.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:blocks.noop,i=function(){d.animating-=1,e.animating-=1,d.animating||h()};if(1!=b.nodeType)return void h();if("show"==g&&(b.style.display=""),d.preprocess)return void h();if(f){c=!0,d.animating+=1,e.animating+=1;var j=blocks.context(b),k=j.$view||j.$root;f.call(k,b,i,g)}return c||cssAnimate(g,b,h,i)}function cssAnimate(a,b,c,d){function e(){setClass("remove",b,"b-"+a),setClass("remove",b,"b-"+a+"-end"),d(),b.removeEventListener("transitionend",e,!1),b.removeEventListener(f,e,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();setClass("add",b,"b-"+a);var f,g=window.getComputedStyle(b),h="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(h="-webkit-",f="webkitAnimationEnd"):f="animationend";var i=parseFloat(g["transition-duration"])||0,j=parseFloat(g["transition-delay"])||0,k=parseFloat(g[h+"animation-duration"])||0,l=parseFloat(g[h+"animation-delay"])||0;return 0>=i&&0>=j&&0>=k&&0>=l?(setClass("remove",b,"b-"+a),void c()):(ElementsData.createIfNotExists(b).animating+=1,ElementsData.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){setClass("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",e,!1),b.addEventListener(f,e,!1)},1),!0)}function HtmlCommentElement(a){return HtmlCommentElement.prototype.isPrototypeOf(this)?void(this._element=a):new HtmlCommentElement(a)}function VirtualComment(a){return VirtualComment.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==a.nodeType?(this._commentText=a.nodeValue,this._el=HtmlCommentElement(a)):this._commentText=a)):new VirtualComment(a)}function createVirtual(a,b){for(var c,d,e,f,g,h,i,j,k,l=window.__blocksServerData__,m=[];a;){if(h=a.nodeType,1==h){d=a.tagName.toLowerCase(),c=new VirtualElement(a),c._tagName=d,c._parent=b,c._haveAttributes=!1,f=a.attributes,e={};for(var n=0;n<f.length;n++)g=f[n],"style"!==g.nodeName&&(g.specified||browser.IE<8&&"value"==g.nodeName&&g.nodeValue)&&(e[g.nodeName.toLowerCase()]=browser.IE<11?g.nodeValue:g.value,c._haveAttributes=!0);c._attributes=e,c._createAttributeExpressions(l),a.style.cssText&&(c._haveStyle=!0,c._style=generateStyleObject(a.style.cssText)),setIsSelfClosing(c),"script"==d||"style"==d||"code"==d||c.hasClass("bl-skip")?c._innerHTML=a.innerHTML:c._children=createVirtual(a.childNodes[0],c),m.push(c)}else if(3==h)k=escapeValue(a.data),m.push(Expression.Create(k,null,a)||k);else if(8==h)if(i=a.nodeValue,j=i.replace(trimRegExp,""),0===j.indexOf("blocks"))c=new VirtualComment(a),c._parent=b,c._attributes[dataQueryAttr]=j.substring(6),k=createVirtual(a.nextSibling,c),c._children=k.elements,c._el._endElement=k.htmlElement,a=k.htmlElement||a,m.push(c);else{if(VirtualComment.Is(b)&&0===j.indexOf("/blocks"))return{elements:m,htmlElement:a};if(VirtualComment.Is(b))m.push("<!--"+i+"-->");else if(l){var o=parseInt(/[0-9]+/.exec(j),10);!blocks.isNaN(o)&&l[o]&&m.push(Expression.Create(l[o]))}else 0!==j.indexOf("/blocks")&&m.push("<!--"+i+"-->")}a=a.nextSibling}return m}function generateStyleObject(a){for(var b,c,d,e=a.split(";"),f={},g=0;g<e.length;g++)c=e[g],c&&(b=c.indexOf(":"),-1!=b&&(d=[c.substring(0,b),c.substring(b+1)],f[d[0].toLowerCase().replace(trimRegExp,"")]=d[1].replace(trimRegExp,"")));return f}function setIsSelfClosing(a){var b,c=a._tagName;return void 0!==isSelfClosingCache[c]?void(a._isSelfClosing=isSelfClosingCache[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(isSelfClosingCache[c]=a._isSelfClosing=-1===b.innerHTML.indexOf("</")))}function createProperty(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}function parseQuery(a,b){var c,d,e=0,f=0,g=0,h=0,i=!1,j=!1,k=0,l=[];a=a||"";for(var m=0;m<a.length;m++)e=a.charAt(m),i||j||("["==e?h++:"]"==e?h--:"{"==e?g++:"}"==e&&g--),0===g&&0===h&&("'"==e?i=!i:'"'==e&&(j=!j),i||j||("("==e?(0===f&&(d=a.substring(k,m).replace(trimRegExp,""),k=m+1),f++):")"==e?(f--,0===f&&(c=a.substring(k,m).replace(trimRegExp,""),c.length&&l.push(c),d&&(d=d.replace(/^("|')+|("|')+$/g,""),b(d,l)),l=[],d=void 0)):","==e&&1==f?(c=a.substring(k,m).replace(trimRegExp,""),c.length&&l.push(c),k=m+1):"."==e&&0===f&&(k=m+1)))}function DomQuery(a){this._options=a||{},this._contextProperties={}}function ChunkManager(a){this.observable=a,this.chunkLengths={},this.dispose()}function updateDependencies(a){a._dependencyType&&(a._getDependency=blocks.bind(getDependency,a),a.on("get",a._getDependency))}function getDependency(){var a=this,b=a.__value__,c=1==a._dependencyType?b:b.get;Events.off(a,"get",a._getDependency),a._getDependency=void 0,Observer.startObserving(),c.call(a.__context__),blocks.each(Observer.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;blocks.each(c,function(b){return a===b?(d=!0,!1):void 0}),d||c.push(a)})}function getObservableValue(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}function initExpressionExtender(a){var b=a.clone();return b.view=blocks.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=blocks.bind(updateObservable,b),b._operations=a._operations?blocks.clone(a._operations):[],b._getter=blocks.bind(getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b}function getter(){Events.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,executeOperations(this)}function updateObservable(){executeOperations(this)}function executeOperations(a){var b=[],c=a.view._observed,d=a.view._updateObservable;blocks.each(c,function(a){Events.off(a,"change",d)}),c=a.view._observed=[],Observer.startObserving(),blocks.each(a._operations,function(c){if("step"==c.type){var d=a.view;a.view=blocks.observable([]),a.view._connections={},b.length&&executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=d,b=[]}b.push(c)}),b.length&&executeOperationsChunk(a,b),blocks.each(Observer.stopObserving(),function(a){c.push(a),a.on("change",d)})}function executeOperationsChunk(a,b){var c="add",d="remove",e="exists",f=e,g=a.__value__,h=a.view,i=h._connections,j={},k=0,l=h.update,m=0,n=g.length;h.update=blocks.noop,blocks.each(b,function(c){"skip"==c.type?(m=c.skip,blocks.isFunction(m)&&(m=m.call(a.__context__)),m=blocks.unwrap(m)):"take"==c.type?(n=c.take,blocks.isFunction(n)&&(n=n.call(a.__context__)),n=blocks.unwrap(n)):"sort"==c.type&&(g=blocks.isString(c.sort)?blocks.clone(g).sort(function(a,b){return a[c.sort]-b[c.sort]}):blocks.isFunction(c.sort)?blocks.clone(g).sort(c.sort):blocks.clone(g).sort(),1==b.length&&b.push({type:"filter",filter:function(){return!0}}))}),blocks.each(g,function(l,o){if(0>=n){for(;h().length-k>0;)h.removeAt(h().length-1);return!1}switch(blocks.each(b,function(b){var h=b.filter;if(f=void 0,h){if(!h.call(a.__context__,l,o,g))return f=void 0,void 0!==i[o]&&(f=d),!1;f=e,void 0===i[o]&&(f=c)}else if("skip"==b.type){if(f=e,m-=1,m>=0)return f=d,!1;0>m&&void 0===i[o]&&(f=c)}else if("take"==b.type){if(0>=n)return f=d,!1;n-=1,f=e,void 0===i[o]&&(f=c)}}),f){case c:j[o]=k,h.splice(k,0,l),k++;break;case d:h.removeAt(k);break;case e:j[o]=k,k++}}),h._connections=j,h.update=l,h.update()}var Events=function(){function a(a){return function(b,c){return arguments.length>1?Events.on(this,a,b,c):Events.on(this,a,b),this}}var b={on:function(a,b,c){return arguments.length>2?Events.on(this,a,b,c):Events.on(this,a,b),this},off:function(a,b){Events.off(this,a,b)},trigger:function(a){Events.trigger(this,a,blocks.toArray(arguments).slice(1,100))}};return b._trigger=b.trigger,{register:function(c,d){d=blocks.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]=b[f]?b[f]:a(f)}},on:function(a,b,c,d){b=blocks.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});g>f;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,context:d})},off:function(a,b,c){blocks.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?blocks.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:blocks.each(d,function(b,d){return b.callback==c?(a._events[e].splice(d,1),!1):void 0})}):a._events=void 0},trigger:function(a,b){var c,d,e,f;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(f=Array.prototype.slice.call(arguments,2),blocks.each(c,function(b){b&&(d=a,void 0!==b.context&&(d=b.context),b.callback.apply(d,f)===!1&&(e=!1))}))),e},has:function(a,b){return!!blocks.access(a,"_events."+b+".length")}}}();!function(){function a(){if("complete"===document.readyState)setTimeout(c);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",b,!1),window.addEventListener("load",b,!1);else{document.attachEvent("onreadystatechange",b),window.attachEvent("onload",b);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(d){}a&&a.doScroll&&!function e(){if(!blocks.isDomReady){try{a.doScroll("left")}catch(b){return setTimeout(e,50)}c()}}()}}function b(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&c()}function c(){blocks.isDomReady||(blocks.isDomReady=!0,Events.trigger(blocks.core,"domReady"),Events.off(blocks.core,"domReady"))}blocks.isDomReady=!1,blocks.domReady=function(b,c){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(b=parseCallback(b,c),blocks.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(blocks.isDomReady=!0,b()):(Events.on(blocks.core,"domReady",b),a()))}}();var slice=Array.prototype.slice,trimRegExp=/^\s+|\s+$/gm,classAttr="class",queries=blocks.queries={},isMouseEventRegEx=/^(?:mouse|pointer|contextmenu)|click/,isKeyEventRegEx=/^key/;Event.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},Event.CopyProperties=function(a,b,c){blocks.each(Event.PropertiesToCopy[c],function(c){b[c]=a[c]})},Event.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=returnTrue,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=returnTrue,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},Event.fix=function(a){var b=a.type,c=new Event(a);return Event.CopyProperties(a,c,"all"),c.target||(c.target=a.srcElement||document),3===c.target.nodeType&&(c.target=c.target.parentNode),c.metaKey=!!c.metaKey,isMouseEventRegEx.test(b)?Event.fixMouse(a,c):isKeyEventRegEx.test(b)&&null==c.which&&(Event.CopyProperties(a,c,"keyboard"),c.which=null!=a.charCode?a.charCode:a.keyCode),c},Event.fixMouse=function(a,b){var c,d,e,f=a.button,g=a.fromElement;Event.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(d=b.target.ownerDocument||document,e=d.documentElement,c=d.body,b.pageX=a.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),b.pageY=a.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!b.relatedTarget&&g&&(b.relatedTarget=g===b.target?a.toElement:g),b.which||void 0===f||(b.which=1&f?1:2&f?3:4&f?2:0)};var ampRegEx=/&/g,quotRegEx=/"/g,singleQuoteRegEx=/'/g,lessThanRegEx=/</g,greaterThanRegEx=/>/g,dataIdAttr="data-id",parameterQueryCache={},ElementsData=function(){function a(a){var b=a?VirtualElement.Is(a)?a._attributes[dataIdAttr]:1==a.nodeType?a.getAttribute(dataIdAttr):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return blocks.isArray(b)?b[1]:b}function b(a,b){VirtualElement.Is(a)?a.attr(dataIdAttr,b):1==a.nodeType&&a.setAttribute(dataIdAttr,b)}var c={},d=1,e=[];return{rawData:c,id:function(b){return a(b)},collectGarbage:function(){blocks.each(c,function(a){a&&a.dom&&!document.body.contains(a.dom)&&ElementsData.clear(a.virtual,!0)})},createIfNotExists:function(f){var g,h=c[f&&a(f)];return h||(g=e.pop()||d++,f&&b(f,g),h=c[g]=f?{id:g,virtual:VirtualElement.Is(f)?f:null,animating:0,observables:{},preprocess:VirtualElement.Is(f)}:{id:g}),h},data:function(b,d,e){var f=c[a(b)];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[d]=e),f[d])},clear:function(b,d){var e=a(b),f=c[e];!f||f.haveData&&!d||(blocks.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==c.id&&(a._elements.splice(b,1),b--)}),c[e]=void 0,VirtualElement.Is(b)?b.attr(dataIdAttr,null):1==b.nodeType&&b.removeAttribute(dataIdAttr))}}}(),Observer=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(blocks.each(c,function(a){return a===b?(d=!0,!1):void 0}),d||c.push(b))}}}(),Expression={Create:function(a,b,c){for(var d,e,f,g=-1,h=0,i=[];a.length>++g;)d=a.charAt(g),"{"==d&&"{"==a.charAt(g+1)?e=g+2:"}"==d&&"}"==a.charAt(g+1)&&(e&&(f=a.substring(e,g),b||(f=f.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),d=a.substring(h,e-2),d&&i.push(d),i.push({expression:f,attributeName:b}),h=g+2),e=0);return d=a.substring(h),d&&i.push(d),i.text=a,i.attributeName=b,i.element=c,f?i:null},GetValue:function(a,b,c){var d="";return a?(blocks.each(c,function(e){d+="string"==typeof e?e:Expression.Execute(a,b,e,c).value}),d):c.text},Execute:function(a,b,c,d){var e,f,g,h,i,j=c.expression,k=c.attributeName;i=parameterQueryCache[j]=parameterQueryCache[j]||new Function("c","with(c){with($this){ return "+j+"}}"),Observer.startObserving();try{h=i(a)}catch(l){blocks.debug.expressionFail(j,d.element)}return h=i(a),g=blocks.unwrap(h),g=null==g?"":g.toString(),g=escapeValue(g),f=Observer.stopObserving(),(blocks.isObservable(h)||f.length)&&(k||(b=ElementsData.createIfNotExists()),b&&(b.haveData=!0,e={length:g.length,attr:k,context:a,elementId:b.id,expression:j,entire:d},blocks.each(f,function(a){a._expressionKeys[b.id]||(a._expressionKeys[b.id]=!0,a._expressions.push(e))})),k||(g="<!-- "+b.id+":blocks -->"+g)),{value:g,elementData:b}}},browser={};"undefined"!=typeof document&&blocks.extend(browser,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&parseVersion(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&parseVersion(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))});var Workarounds={input:function(a,b,c){function d(a){clearTimeout(f),b(a)}function e(){f||(f=setTimeout(d,4))}var f;browser.IE<10?(c("propertychange",function(a){"value"===a.originalEvent.propertyName&&d(a)}),8==browser.IE&&(c("keyup",d),c("keydown",d)),browser.IE>=8&&(globalSelectionChangeHandler(a,d),c("dragend",e))):(c("input",d),browser.Safari<7&&"textarea"==a.tagName.toLowerCase()?(c("keydown",e),c("paste",e),c("cut",e)):browser.Opera<11?c("keydown",e):browser.Firefox<4&&(c("DOMAutoComplete",d),c("dragdrop",d),c("drop",d)))}},globalSelectionChangeHandler=function(){function a(a){var b=this.activeElement,c=b&&ElementsData.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(addListener(c.ownerDocument,"selectionchange",a),b=!0),ElementsData.createIfNotExists(c).selectionChange=d}}(),Empty;HtmlElement.Empty=function(){if(!Empty){Empty={};for(var a in HtmlElement.prototype)Empty[a]=blocks.noop}return Empty},HtmlElement.ValueTagNames={input:!0,textarea:!0,select:!0},HtmlElement.ValueTypes={file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},HtmlElement.Props={"for":!0,"class":!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},HtmlElement.PropFix={"for":"htmlFor","class":"className",tabindex:"tabIndex"},HtmlElement.AttrFix={className:"class",htmlFor:"for"},HtmlElement.prototype={addClass:function(a){setClass("add",this._element,a)},removeClass:function(a){setClass("remove",this._element,a)},html:function(a){if(a=a.toString(),browser.IE<10){for(;this._element.firstChild;)this._element.removeChild(this._element.firstChild);this._element.appendChild(createFragment(a))}else this._element.innerHTML=a},attr:function(a,b){var c=HtmlElement.Props[a],d=this._element;return a=HtmlElement.PropFix[a.toLowerCase()]||a,blocks.core.skipExecution&&blocks.core.skipExecution.element===d&&blocks.core.skipExecution.attributeName==a?void 0:("checked"==a&&(b="checked"!=b&&"string"==typeof b&&"radio"==d.getAttribute("type")&&b!=d.value&&null!=d.defaultValue&&""!==d.defaultValue?!1:!!b),1===arguments.length?c?d[a]:d.getAttribute(a):void(null!=b?"value"==a&&"select"==d.tagName.toLowerCase()?(b=keys(blocks.toArray(b)),blocks.each(d.children,function(a){a.selected=!!b[a.value]})):c?d[a]=b:d.setAttribute(a,b):c?"value"==a&&"select"==d.tagName.toLowerCase()?d.selectedIndex=-1:d[a]&&(d[a]=""):d.removeAttribute(a)))},removeAttr:function(a){this.attr(a,null)},css:function(a,b){if(a){var c=this._element;"display"==a?animation.setVisibility(c,"none"==b?!1:!0):c.style[a]=b}},on:function(a,b){on(this._element,a,b)},off:function(){}},blocks.VirtualElement=blocks.inherit(VirtualElement,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._innerHTML=a,this._children=[],this._el.html(a),this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=escapeValue(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,b){var c,d=this;if("string"==typeof a){var e=this._tagName,f=this._attributes.type,g=b,h=ElementsData.data(this);if(a=blocks.unwrapObservable(a),a=HtmlElement.AttrFix[a]||a,b=blocks.unwrapObservable(b),blocks.isObservable(g)&&"value"==a&&HtmlElement.ValueTagNames[e]&&(!f||HtmlElement.ValueTypes[f])?(h.subscribe="select"==e?"change":"input",h.valueObservable=g):!blocks.isObservable(g)||"checked"!=a||"checkbox"!=f&&"radio"!=f||(h.subscribe="click",h.valueObservable=g),1==arguments.length)return c=this._attributes[a],void 0===c?null:c;"checked"!=a||null==b||this._fake?"disabled"==a&&(b=b?"disabled":null):b="radio"==this._attributes.type&&"string"==typeof b&&b!=this._attributes.value&&null!=this._attributes.value?null:b?"checked":null,"textarea"==e&&"value"==a&&this._el==HtmlElement.Empty()?this.html(b):"value"==a&&"select"==e?(this._values=keys(blocks.toArray(b)),this._el.attr(a,b)):(this._changes&&this._changes.attributes.push([a,this._attributes[a]]),this._haveAttributes=!0,this._attributes[a]=b,this._el.attr(a,b))}else blocks.isPlainObject(a)&&blocks.each(a,function(a,b){d.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,this._el.removeAttr(a),this},css:function(a,b){var c=this;if("string"==typeof a){if(a=blocks.unwrap(a),b=blocks.unwrap(b),!a)return;if(a=a.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return b=this._style[a],void 0===b?null:b;"display"==a&&(b="none"==b||!b&&""!==b?"none":""),this._changes&&this._changes.styles.push([a,this._style[a]]),this._haveStyle=!0,VirtualElement.CssNumbers[a]||(b=blocks.toUnit(b)),this._style[a]=b,this._el.css(a,b)}else blocks.isPlainObject(a)&&blocks.each(a,function(a,b){c.css(b,a)});return this},addChild:function(a,b){var c=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el._element&&("number"==typeof b?this._el.element.insertBefore(createFragment(a.render(blocks.domQuery(this))),this._el.element.childNodes[b]):this._el._element.appendChild(createFragment(a.render(blocks.domQuery(this))))),"number"==typeof b?c.splice(b,0,a):c.push(a)),this},addClass:function(a){return setClass("add",this,a),this._el.addClass(a),this},removeClass:function(a){return setClass("remove",this,a),this._el.removeClass(a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return-1!=getClassIndex(this._attributes[classAttr],a)},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=generateStyleAttribute(this._style)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(a){var b="",c="",d=this._el;return this._el=HtmlElement.Empty(),this._execute(a),this._el=d,this._renderMode!=VirtualElement.RenderMode.None&&(this._renderMode!=VirtualElement.RenderMode.ElementOnly&&(c=null!=this._innerHTML?this._innerHTML:this.renderChildren(a)),b+=this.renderBeginTag(),b+=c,b+=this.renderEndTag()),b},renderChildren:function(a){for(var b,c="",d=this._template||this._children,e=d.length,f=-1;++f<e;)b=d[f],"string"==typeof b?c+=b:VirtualElement.Is(b)?(b._each=b._each||this._each,c+=b.render(a)):c+=a?Expression.GetValue(a._context,null,b):Expression.GetValue(null,null,b);return c},sync:function(a){this._execute(a);var b,c,d,e=this._children,f=e.length,g=-1;if(this.renderBeginTag(),this._innerHTML||this._childrenEach)return void this.renderEndTag();for(;++g<f;)d=e[g],VirtualElement.Is(d)?(d._each=d._each||this._each,d.sync(a),b=null,c=d):"string"!=typeof d&&a&&(b=b&&b.nextSibling||c&&c._el._element.nextSibling,b||(b=1==this._el._element.nodeType?this._el._element.childNodes[0]:this._el._element.nextSibling),b&&(b.parentNode.insertBefore(createFragment(Expression.GetValue(a._context,null,d)),b),b.parentNode.removeChild(b)));this.renderEndTag()},_execute:function(a){this._each&&(this._revertChanges(),this._trackChanges(),this._el=HtmlElement.Empty()),this._renderMode!=VirtualElement.RenderMode.None&&a&&(ElementsData.createIfNotExists(this),a.applyContextToElement(this),this._executeAttributeExpressions(a._context),a.executeElementQuery(this),ElementsData.clear(this))},_renderAttributes:function(){var a,b,c=this._attributes,d="";"option"==this._tagName&&this._parent._values&&(c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],""===b?d+=" "+a:null!=b&&(d+=" "+a+'="'+b+'"');return d},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[dataIdAttr];blocks.each(this._attributes,function(e,f){b=a?Expression.Create(a[d+f]||"",f):Expression.Create(e,f),b&&c.push(b)})},_executeAttributeExpressions:function(a){var b=this._each||HtmlElement.Empty()===this._el?this:this._el,c=ElementsData.data(this);blocks.each(this._attributeExpressions,function(d){b.attr(d.attributeName,Expression.GetValue(a,c,d))})},_revertChanges:function(){if(this._changes){for(var a,b,c=this._style,d=this._attributes,e=this._changes,f=e.styles,g=e.attributes,h=Math.max(f.length,g.length),i=h-1;i>=0;i--)a=f[i],b=g[i],a&&(c[a[0]]=a[1]),b&&(d[b[0]]=b[1]);this._attributes[classAttr]=e[classAttr],this._tagName=e.tagName,this._innerHTML=e.html,this._renderMode=VirtualElement.RenderMode.All}},_trackChanges:function(){this._changes={styles:[],attributes:[],"class":this._attributes[classAttr],html:this._innerHTML,tagName:this._tagName}},_removeRelation:function(){this._el=HtmlElement.Empty()}}),VirtualElement.Is=function(a){return VirtualElement.prototype.isPrototypeOf(a)},VirtualElement.RenderMode={All:0,ElementOnly:2,None:4},VirtualElement.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0};var classListMultiArguments=!0;if("undefined"!=typeof document){var element=document.createElement("div");element.classList&&(element.classList.add("a","b"),classListMultiArguments="a b"==element.className)}var animation={insert:function(a,b,c){b=getIndexOffset(a,b);var d,e,f=a.childNodes[b];blocks.each(c,function(b){if(d=11==b.nodeType?b.childNodes.length:0,e=b.childNodes?b.childNodes[0]:void 0,f?a.insertBefore(b,f):a.appendChild(b),d)for(;d;)animateDomAction("add",e),e=e.nextSibling,d--;else animateDomAction("add",b)})},remove:function(a,b,c){var d,e=0;for(b=getIndexOffset(a,b);c>e;e++)d=a.childNodes[b],d&&animateDomAction("remove",d)&&b++},setVisibility:function(a,b){b?animation.show(a):animation.hide(a)},show:function(a){animateDomAction("show",a)},hide:function(a){animateDomAction("hide",a)}},dataQueryAttr="data-query";HtmlCommentElement.prototype=blocks.clone(HtmlElement.Empty()),blocks.extend(HtmlCommentElement.prototype,{html:function(a){for(var b,c=this._element,d=c.parentNode,e=c.nextSibling,f=0;e&&(8!=e.nodeType||-1==e.nodeValue.indexOf("/blocks"));)f++,b=e.nextSibling,d.removeChild(e),e=b;return d.insertBefore(createFragment(a),c.nextSibling),f},attr:function(a,b){if(a==dataIdAttr&&b){var c=this._element,d=this._endElement;return c.nodeValue=" "+b+":"+c.nodeValue.replace(trimRegExp,"")+" ",d.nodeValue=" "+b+":"+d.nodeValue.replace(trimRegExp,"")+" ",this}return this}}),blocks.VirtualComment=blocks.inherit(VirtualElement,VirtualComment,{renderBeginTag:function(){var a=this._attributes[dataIdAttr],b="<!-- ";return a&&(b+=a+":"),b+=this._commentText.replace(trimRegExp,"")+" -->"},renderEndTag:function(){var a=this._attributes[dataIdAttr],b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:blocks.noop}),VirtualComment.Is=function(a){return VirtualComment.prototype.isPrototypeOf(a)};var isSelfClosingCache={};DomQuery.QueryCache={},DomQuery.prototype={options:function(){return this._options},dataIndex:createProperty("_dataIndex"),context:createProperty("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=ElementsData.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=ElementsData.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null},b.$context=b,this._context=b,this.applyDefinedContextProperties(),b},addProperty:function(a,b){this._contextProperties[a]=b,this.applyDefinedContextProperties()},removeProperty:function(a){delete this._contextProperties[a]},applyDefinedContextProperties:function(){var a,b=this._context,c=this._contextProperties;for(a in c)b[a]=c[a]},executeElementQuery:function(a){var b=VirtualElement.Is(a)?a._attributes[dataQueryAttr]:1==a.nodeType?a.getAttribute(dataQueryAttr):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(trimRegExp,"");b&&this.executeQuery(a,b)},executeQuery:function(a,b){var c=DomQuery.QueryCache[b];c||(c=DomQuery.QueryCache[b]=[],parseQuery(b,function(b,d){var e=blocks.queries[b],f={name:b,params:d,query:b+"("+d.join(",")+")"};e?"attr"==b||"val"==b?c.unshift(f):c.push(f):blocks.debug.queryNotExists(f,a)})),this.executeMethods(a,c)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=ElementsData.data(a),k=0,l=0;l<b.length;l++)if(h=this._context,c=blocks.queries[b[l].name],f=b[l].params,d=c.passDomQuery?[this]:[],!VirtualElement.Is(a)||c.call||c.preprocess||!c.update){Observer.startObserving();for(var m=0;m<f.length;m++){g=f[m],i=parameterQueryCache[g]=parameterQueryCache[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={};try{e.rawValue=i(h)}catch(n){blocks.debug.queryParameterFail(b[l],g,a)}if(e.rawValue=i(h),e.value=blocks.unwrapObservable(e.rawValue),c.passDetailValues?(e.isObservable=blocks.isObservable(e.rawValue),e.containsObservable=Observer.currentObservables().length>k,k=Observer.currentObservables().length,d.push(e)):d.push(c.passRawValues?e.rawValue:e.value),c===blocks.queries["if"]||c===blocks.queries.ifnot){if(!e.value&&c===blocks.queries["if"]||e.value&&c===blocks.queries.ifnot){if(!f[2])break;
this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}}var o=d;if(c.passDomQuery&&(o=blocks.clone(d).slice(1)),blocks.debug.checkQuery(b[l].name,o,b[l],a),VirtualElement.Is(a)){if(VirtualComment.Is(a)&&!c.supportsComments)continue;if(c.call)c.call===!0?a[b[l].name].apply(a,d):(d.unshift(c.prefix||b[l].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[l],j,h);break}}else if(c.call){var p=ElementsData.data(a).virtual;p._each&&(p=VirtualElement("div"),p._el=HtmlElement(a),p._fake=!0),c.call===!0?p[b[l].name].apply(p,d):(d.unshift(c.prefix||b[l].name),p[c.call].apply(p,d))}else c.update&&c.update.apply(a,d);this.subscribeObservables(b[l],j,h)}else j.haveData=!0,j.execute||(j.execute=[]),j.execute.push(b[l])},subscribeObservables:function(a,b,c){var d=Observer.stopObserving();b&&(b.haveData=!0,blocks.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e],d=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(c=ElementsData.data(b)){if(this._context=c.context||this._context,c.dom=b,c.execute&&this.executeMethods(b,c.execute),c.subscribe){var f=c.updateOn||c.subscribe;on(b,f,UpdateHandlers[f])}c.preprocess=!1,this._context=c.childrenContext||this._context}"script"!=d&&"code"!=d&&-1==(" "+b.className+" ").indexOf("bl-skip")&&this.createElementObservableDependencies(b.childNodes)}},createFragment:function(a){var b=createFragment(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=blocks.clone(a);return b.$context=b,b}};var UpdateHandlers={change:function(a){var b=a.target||a.srcElement;UpdateHandlers.getSetValue(b,ElementsData.data(b).valueObservable)},click:function(a){UpdateHandlers.change(a)},input:function(a){var b=a.target||a.srcElement;UpdateHandlers.getSetValue(b,ElementsData.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,c=b.value,d=ElementsData.data(b);d&&setTimeout(function(){c!=b.value&&UpdateHandlers.getSetValue(b,ElementsData.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if("checkbox"==d)b(a.checked);else if("select"==c&&a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?blocks.each(f,function(a){e.push(a.getAttribute("value"))}):blocks.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else blocks.core.skipExecution={element:a,attributeName:"value"},b(a.value),blocks.core.skipExecution=void 0}};blocks.extend(queries,{"if":{},ifnot:{},template:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){var d;b=blocks.$unwrap(b),blocks.isElement(b)?d=b.innerHTML:(d=document.getElementById(b),d=d?d.innerHTML:b),d&&(c&&blocks.queries["with"].preprocess.call(this,a,c,"$template"),this.html(d),this._each||(this._children=createVirtual(this._el._element.childNodes[0],this),this._innerHTML=null))}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=VirtualElement.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.removeProperty(b),a.context(d),f.call(this)}}}},"with":{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=VirtualElement.RenderMode.None){var d=this.renderEndTag;c&&a.addProperty(c,b),a.pushContext(b),this.renderEndTag=function(){return c&&a.removeProperty(c),a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,d,e,f=b._children,g=b._headers,h=b._footers,i=-1,j="",k="";if(g)for(c=Math.max(g.length,h.length);++i<c;)g[i]&&(j+=g[i].render(a)),h[i]&&(k+=h[i].render(a));else for(g=b._headers=[],h=b._footers=[];++i<f.length;)e=f[i],"string"!=typeof e?(e._each=!0,d=e._attributes["data-role"],"header"==d?(j+=e.render(a),g.push(e),f.splice(i--,1)):"footer"==d&&(k+=e.render(a),h.push(e),f.splice(i--,1))):""===e.replace(trimRegExp,"").replace(/(\r\n|\n|\r)/gm,"")&&f.splice(i--,1);return{header:j,headersCount:g.length,footer:k,footersCount:h.length}},preprocess:function(a,b,c){var d,e,f,g,h,i,j=this,k=0;if(j._template=j._template||j._children,this._childrenEach=!0,a._serverData&&(e=a._serverData[ElementsData.data(j).id])){var l=document.createElement("div");l.innerHTML=e,j._template=j._children=createVirtual(l.childNodes[0])}if(g=queries.each._getStaticHtml(a,j),i=g.header,blocks.isObservable(b)&&(e=ElementsData.data(j),e.eachData={id:b.__id__,element:j,startOffset:g.headersCount,endOffset:g.footersCount}),d=blocks.unwrapObservable(b),blocks.isArray(d))for(f=f||0,h=h||d.length,k=0;k<d.length;k++)a.dataIndex(blocks.observable.getIndex(b,k)),a.pushContext(d[k]),c&&blocks.queries.define.preprocess.call(j,a,c,d[k]),i+=j.renderChildren(a),a.popContext(),a.dataIndex(void 0);else if(blocks.isObject(d))for(var m in d)a.dataIndex(blocks.observable.getIndex(b,k)),a.pushContext(d[m]),i+=j.renderChildren(a),a.popContext(),a.dataIndex(void 0),k++;this.html(i+g.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};for(var d,e="$this",f=Expression.Create("{{"+(c.text||e)+"}}"),g=Expression.Create("{{"+(c.value||e)+"}}","value"),h=blocks.isString(c.caption)&&new VirtualElement("option"),i=new VirtualElement("option"),j=this._children,k=0;k<j.length;k++)d=j[k],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(k--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,this._children.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,this.addChild(h)),blocks.queries.each.preprocess.call(this,a,b)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each)throw new Error("render() is supported only in each context");this._renderMode=a.value?VirtualElement.RenderMode.All:VirtualElement.RenderMode.None,a.containsObservable&&this._renderMode==VirtualElement.RenderMode.None&&(this._renderMode=VirtualElement.RenderMode.ElementOnly,this.css("display","none"),ElementsData.data(this,"renderCache",this))},update:function(a){var b=ElementsData.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(blocks.domQuery(this)),blocks.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){ElementsData.data(this).updateOn=a}},animate:{preprocess:function(a){ElementsData.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=ElementsData.data(this).virtual;c._each&&(c=VirtualElement(),c._el=HtmlElement(this)),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:blocks.noop,update:function(a){a&&this.focus()}},on:{update:function(a,b,c){if(a&&b){b=blocks.toArray(b);var d=this,e=function(a){var d=blocks.context(this),e=d.$template||d.$view||d.$root;blocks.each(b,function(b){b.call(e,a,c)})};a=blocks.isArray(a)?a:a.toString().split(" "),blocks.each(a,function(a){addListener(d,a,e)})}}}}),blocks.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){blocks.queries[a]={passRawValues:!0,update:function(b,c){blocks.queries.on.update.call(this,a,b,c)}}});var OBSERVABLE="__blocks.observable__";ChunkManager.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable.__value__.length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=ElementsData.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable.__value__.length);return b=blocks.isNaN(e)||1/0===e?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;c>f;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){animation.insert(a,this.chunkLength(a)*b+this.startIndex,blocks.isArray(c)?c:[c])},removeAt:function(a,b){var c=this.chunkLength(a);animation.remove(a,c*b+this.startIndex,c)},removeAll:function(){var a=this,b=this.observable.__value__;this.each(function(c){blocks.each(b,function(){a.removeAt(c,0)})})},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=ElementsData.rawData[d.elementId].dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=ElementsData.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=ElementsData.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}}};var observableId=1;blocks.observable=function(a,b){var c=function(a){0===arguments.length&&Events.trigger(c,"get",c);var b=getObservableValue(c);return 0===arguments.length?(Observer.registerObservable(c),b):(blocks.equals(a,b,!1)||Events.trigger(c,"changing",a,b)===!1||(c._dependencyType?2==c._dependencyType&&c.__value__.set.call(c.__context__,a):blocks.isArray(b)&&blocks.isArray(a)&&c.removeAll&&c.addMany?(c.removeAll(),c.addMany(a)):c.__value__=a,c.update(),Events.trigger(c,"change",a,b)),c)};return a=blocks.unwrap(a),blocks.extend(c,blocks.observable.fn.base),c.__id__=observableId++,c.__value__=a,c.__context__=b||blocks.__viewInInitialize__||c,c._expressionKeys={},c._expressions=[],c._elementKeys={},c._elements=[],blocks.isArray(a)?(blocks.extend(c,blocks.observable.fn.array),c._indexes=[],c._chunkManager=new ChunkManager(c)):blocks.isFunction(a)?c._dependencyType=1:a&&blocks.isFunction(a.get)&&blocks.isFunction(a.set)&&(c._dependencyType=2),updateDependencies(c),c},blocks.extend(blocks.observable,{getIndex:function(a,b,c){if(!blocks.isObservable(a))return blocks.observable(b);var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=blocks.observable(b),e.push(d)):d=blocks.observable(b),d},fn:{base:{__identity__:OBSERVABLE,update:function(){var a,b,c,d,e,f=this._elements;blocks.eachRight(this._expressions,function(a){c=a.element,b=a.context,c||(c=a.element=ElementsData.rawData[a.elementId].dom);try{e=blocks.unwrap(parameterQueryCache[a.expression](b))}catch(f){e=""}e=null==e?"":e.toString(),d=a.length-e.length,a.length=e.length,a.attr?c.setAttribute(a.attr,Expression.GetValue(b,null,a.entire)):c.nextSibling?(c=c.nextSibling,c.nodeValue=e+c.nodeValue.substring(a.length+d)):c.parentNode.appendChild(document.createTextNode(e))});for(var g=0;g<f.length;g++)e=f[g],c=e.element,!c&&ElementsData.rawData[e.elementId]&&(c=e.element=ElementsData.rawData[e.elementId].dom,c||(c=ElementsData.rawData[e.elementId].virtual)),document.body.contains(c)||VirtualElement.Is(c)?(a=blocks.domQuery(c),a.context(e.context),a.executeMethods(c,e.cache),a.popContext()):(f.splice(g,1),g-=1);return blocks.each(this._dependencies,function(a){updateDependencies(a),a.update()}),blocks.each(this._indexes,function(a,b){a(b)}),this},on:function(a,b,c){return Events.on(this,a,b,c||this.__context__),this},extend:function(a){var b,c=blocks.observable[a];return 0===arguments.length?(blocks.core.expressionsCreated&&blocks.core.applyExpressions(blocks.type(this()),this),this):c?(b=c.apply(this,blocks.toArray(arguments).slice(1)),blocks.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return blocks.observable(a?blocks.clone(b):b,this.__context__)},toString:function(){var a=this.__context__,b=1==this._dependencyType?this.__value__.call(a):2==this._dependencyType?this.__value__.get.call(a):this.__value__;return Observer.registerObservable(this),null!=b&&blocks.isFunction(b.toString)?b.toString():String(b)}},array:{reset:function(a){return a=blocks.isArray(a)?a:[],this(a)},add:function(a,b){return this.splice(blocks.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[blocks.isNumber(b)?b:this.__value__.length,0].concat(blocks.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;blocks.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;blocks.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return blocks.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,c){var d,e,f=this.__value__,g=this._chunkManager;if(0===arguments.length)(Events.has(this,"removing")||Events.has(this,"remove"))&&(d=blocks.clone(f)),Events.trigger(this,"removing",{type:"removing",items:d,index:0}),g.removeAll(),this._indexes=[],d=f.splice(0,f.length),Events.trigger(this,"remove",{type:"remove",items:d,index:0});else{var h,i=blocks.isFunction(a);for(e=0;e<f.length&&(h=f[e],!(h===a||i&&a.call(b,h,e,f))||(this.splice(e,1),e-=1,!c));e++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,blocks.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(arguments),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;e>i;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):c>b?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;e>i;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var c,d=this,e=this.__value__,f=this._indexes,g=this._chunkManager,h=[],i=arguments;return a=0>a?e.length-a:a,b&&a<e.length&&a>=0&&(b=Math.min(e.length-a,b),h=e.slice(a,a+b),Events.trigger(this,"removing",{type:"removing",items:h,index:a}),g.each(function(c){for(var d=0;b>d;d++)g.removeAt(c,a)}),ElementsData.collectGarbage(),f.splice(a,b),h=e.splice(a,b),Events.trigger(this,"remove",{type:"remove",items:h,index:a}),g.dispose()),i.length>2&&(c=blocks.toArray(i),c.splice(0,2),Events.trigger(this,"adding",{type:"adding",index:a,items:c}),blocks.each(c,function(b,c){f.splice(a+c,0,blocks.observable(a+c))}),g.each(function(b,e){var f="",h=c.length,i=0,j=blocks.domQuery(b);for(j.context(blocks.context(b));h>i;i++)j.dataIndex(blocks.observable.getIndex(d,a+i,!0)),j.pushContext(c[i]),f+=e.renderChildren(j),j.popContext(),j.dataIndex(void 0);if(0===b.childNodes.length)new HtmlElement(b).html(f),j.createElementObservableDependencies(b.childNodes);else{var k=j.createFragment(f);g.insertAt(b,a,k)}}),e.splice.apply(e,[a,0].concat(c)),Events.trigger(this,"add",{type:"add",index:a,items:c})),g.dispose(),this.update(),h},unshift:function(){return this.addMany(arguments,0),this.__value__.length}}}}),blocks.observable.filter=function(a){var b=initExpressionExtender(this);return b._operations.push({type:"filter",filter:a}),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),executeOperations(b))}),b},blocks.observable.step=function(a){var b=initExpressionExtender(this);return b._operations.push({type:"step",step:a}),b},blocks.observable.skip=function(a){var b=initExpressionExtender(this);return b._operations.push({type:"skip",skip:a}),b},blocks.observable.take=function(a){var b=initExpressionExtender(this);return b._operations.push({type:"take",take:a}),b},blocks.observable.sort=function(a){var b=initExpressionExtender(this);return b._operations.push({type:"sort",sort:a}),b},blocks.query=function(a,b){blocks.domReady(function(){blocks.$unwrap(b,function(b){blocks.isElement(b)||(b=document.body);var c=new DomQuery,d=createVirtual(b)[0],e=window.__blocksServerData__;c.pushContext(a),c._serverData=e,e?d.render(c):d.sync(c),c.createElementObservableDependencies([b])})})},blocks.executeQuery=function(a,b){var c=VirtualElement.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=blocks.queries[b];e.passDomQuery&&d.unshift(blocks.domQuery(a)),e[c].apply(a,d)},blocks.context=function(a,b){if(a=blocks.$unwrap(a)){var c=ElementsData.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return blocks.context(VirtualElement.Is(a)?a._parent:a.parentNode,!0)}return null},blocks.dataItem=function(a){var b=blocks.context(a);return b?b.$this:null},blocks.isObservable=function(a){return!!a&&a.__identity__===OBSERVABLE},blocks.unwrapObservable=function(a){return a&&a.__identity__===OBSERVABLE?a():a},blocks.domQuery=function(a){if(a=blocks.$unwrap(a)){var b=ElementsData.data(a,"domQuery");return b?b:blocks.domQuery(VirtualElement.Is(a)?a._parent:a.parentNode)}return null};